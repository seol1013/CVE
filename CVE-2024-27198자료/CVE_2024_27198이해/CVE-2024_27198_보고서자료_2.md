
---

# 📌 CVE-2024-27198 취약점 분석 보고서

**Target**: JetBrains TeamCity (On-Premises)  
**Severity**: Critical (CVSS 9.8)  
**Impact**: Authentication Bypass → Admin Account Creation → Plugin Upload → RCE

---

## 1. 취약점 개요 (Executive Summary)

**CVE-2024-27198**은 JetBrains TeamCity 서버의 **Web 컴포넌트 인증 로직 결함**으로 인해,  
**비인증 공격자가 관리자 권한을 획득하고 원격 코드 실행(RCE)까지 수행할 수 있는 치명적 취약점**이다.

이 취약점은 단순 정보 노출 수준이 아니라:

- 인증 절차 완전 우회
    
- 관리자 계정 생성
    
- 관리자 API 토큰 발급
    
- 악성 플러그인 업로드
    
- 서버 권한 명령 실행 (RCE)
    

이라는 **완전한 공격 체인(full exploit chain)** 을 형성한다.

---

## 2. 영향 받는 소프트웨어 및 버전

### ✔ 영향 대상

- **JetBrains TeamCity (On-Premises / Self-Hosted)**
    

### ✔ 영향 버전

- **TeamCity 2023.11.4 이전 모든 버전**
    
- 2023.11.4에서 취약점 패치 완료
    

### ✔ 영향 범위

- 외부에서 접근 가능한 TeamCity 서버
    
- VPN/사내망 환경이라도 내부 공격자 또는 침해 후 횡적 이동 시 고위험
    

---

## 3. 전체 공격 흐름 (Attack Flow Overview)

### 🔴 전체 공격 체인 개요

![Image](https://www.trendmicro.com/content/dam/trendmicro/global/en/research/24/c/teamcity-vulnerability-exploits-lead-to-jasmin-ransomware/fig11.jpg)

![Image](https://www.fortinet.com/blog/threat-research/teamcity-intrusion-saga-apt29-suspected-exploiting-cve-2023-42793/_jcr_content/root/responsivegrid/table_content/par/image.img.png/1702312937909/cyber-kill-chain-1211.png)

![Image](https://www.paloaltonetworks.com/content/dam/pan/en_US/images/cyberpedia/Eight-step-supply-chain-compromise-operation.png?imwidth=480)

### 🔁 흐름도 (텍스트 버전)

```
[외부 공격자]
      │
      ▼
[인증 우회 요청]
  (Alternate Path)
      │
      ▼
[관리자 권한 API 접근]
      │
      ▼
[관리자 계정 생성]
      │
      ▼
[API 토큰 발급]
      │
      ▼
[악성 플러그인 업로드]
      │
      ▼
[웹쉘 배포]
      │
      ▼
[RCE (서버 장악)]
```

---

## 4. 단계별 공격 매커니즘 (Detailed Attack Mechanism)

---

### 🔹 STEP 1. 인증 우회 (Authentication Bypass)

#### 🔍 핵심 원인

- TeamCity Web 컴포넌트의 **대체 경로(Alternate Path) 처리 결함**
    
- 요청 처리 중 **인증 검사보다 JSP View 처리 로직이 먼저 실행됨**
    

#### 🔧 기술적 설명

- 특정 요청이 들어오면 내부적으로  
    `updateViewIfRequestHasJspParameter()`  
    메서드가 호출됨
    
- 이 메서드는 **권한 검증 없이 JSP 렌더링 경로를 갱신**
    
- 결과적으로 **인증 필터 체인을 우회**
    

#### 🔎 공격 특징

- 로그인 없이 관리자 API 접근 가능
    
- 서버 로그에 다음 패턴이 남는 경우가 많음:
    
    - `jsp=`
        
    - `;.jsp`
        

---

### 🔹 STEP 2. 관리자 계정 생성

#### 🔍 설명

- 인증이 필요한 REST API 엔드포인트 접근 가능
    
- 공격자는 관리자 권한의 신규 계정을 생성
    

#### 🔐 보안적 의미

- 단발성 우회가 아니라 **영구적 관리자 계정 확보**
    
- 이후 모든 관리 기능 정상 사용 가능
    

---

### 🔹 STEP 3. 관리자 API 토큰 발급

#### 🔍 설명

- 생성한 관리자 계정으로 API 토큰 발급
    
- 세션 없이도 관리자 기능 접근 가능
    

#### 🎯 공격자 관점 이점

- 패스워드 변경에도 영향 없음
    
- 장기 침투(Persistence) 가능
    
- 자동화 공격 용이
    

---

### 🔹 STEP 4. 악성 플러그인 제작

#### 🔍 설명

- TeamCity는 **플러그인(.jar/.zip)** 을 서버에 직접 로딩
    
- 플러그인 내부에 JSP 웹쉘 포함 가능
    

#### ⚠ 위험 포인트

- 플러그인은 서버 프로세스 권한으로 실행
    
- CI/CD 서버 특성상 **고권한 시스템 접근 가능**
    

---

### 🔹 STEP 5. 플러그인 업로드 및 활성화

#### 🔍 설명

- 관리자 페이지(`/admin/plugins.html`) 접근
    
- 플러그인 업로드 → 활성화
    

#### 🔐 결과

- 웹 루트 또는 리소스 디렉터리에 웹쉘 배치
    
- HTTP 요청을 통한 명령 실행 가능
    

---

### 🔹 STEP 6. 원격 코드 실행 (RCE)

#### 🔍 설명

- 웹쉘 엔드포인트로 명령 전달
    
- 서버 OS 명령 실행 결과 반환
    

#### 🚨 영향

- TeamCity 서버 완전 장악
    
- 빌드 서버 → 내부망 확산
    
- 소스코드·비밀키·배포 파이프라인 탈취 가능
    

---

## 5. 기술적 취약점 분석 (Root Cause Analysis)

### 🔴 근본 원인 요약

|구분|내용|
|---|---|
|취약점 유형|Authentication Bypass|
|CWE|CWE-288 (Authentication Bypass)|
|원인|Alternate Path + View 처리 우선 실행|
|문제점|인증 필터 이전에 JSP 렌더링 수행|

### 🔎 핵심 문제

- **인증 로직은 “정상 경로”만 보호**
    
- View/JSP 처리 로직이 별도 분기로 존재
    
- 보안 설계상 **Defense in Depth 부재**
    

---

## 6. 침해 시나리오 (Realistic Incident Scenario)

### 📌 실제 공격 가능 시나리오

1. 공격자가 인터넷 스캐닝으로 TeamCity 서버 발견
    
2. 인증 우회 요청 1회 전송
    
3. 관리자 계정 생성
    
4. API 토큰 발급
    
5. 악성 플러그인 업로드
    
6. RCE 확보
    
7. CI/CD 파이프라인 변조
    
8. 악성 코드가 정식 배포본에 삽입
    

➡ **소프트웨어 공급망 공격(Supply Chain Attack)** 으로 확장 가능

---

## 7. 침해 지표 (IOC) & 탐지 포인트

### 🔎 로그 점검 포인트

|항목|확인 내용|
|---|---|
|로그 파일|`teamcity-server.log`, `teamcity-javaLogging.log`|
|의심 요청|`jsp=`, `;.jsp` 포함|
|계정|생성 시점이 비정상적인 관리자 계정|
|플러그인|알 수 없는 플러그인 업로드 기록|

---

## 8. 대응 및 권고사항 (Mitigation & Recommendation)

### ✅ 즉시 대응

- **TeamCity 2023.11.4 이상으로 즉시 업데이트**
    
- 외부 노출 차단 (방화벽/VPN)
    

### 🔐 보안 강화

- 관리자 계정 전체 점검
    
- API 토큰 전수 폐기 및 재발급
    
- 플러그인 무결성 점검
    

### 🧠 사고 대응 관점

- **이미 침해되었음을 전제로 대응**
    
- 서버 재설치 고려
    
- 빌드 산출물 전체 무결성 검증
    

---

## 9. 결론 (Conclusion)

CVE-2024-27198은 단순한 웹 취약점이 아니라:

> **CI/CD 서버를 직접 장악할 수 있는 공급망 공격의 출발점**

이라는 점에서 **매우 위협적**이다.

TeamCity는 개발·배포 파이프라인의 핵심에 위치하기 때문에,  
본 취약점은 **조직 전체 보안 신뢰성을 붕괴**시킬 수 있다.

---

원하면 다음도 바로 해줄 수 있어 👇

- 📄 **보고서 PDF / PPT 구조로 재정리**
    
- 🛡 **Blue-Team 관점 탐지 룰(SIEM/WAF)**
    
- 🔴 **Red-Team 공격 시나리오 요약본**
    
- 🧪 **취약점 vs Spring4Shell 비교 분석**
    

어디까지 필요해?